{% extends 'base.html' %}

{% block title %}Edit Post - MySpace{% endblock %}

{% block content %}
<div class="form-header">
    <h1>‚úèÔ∏è Edit Post</h1>
    <p class="form-subtitle">Update your caption or replace media</p>
</div>

<div class="post-form">
    <form method="POST" enctype="multipart/form-data" id="postForm">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="caption">Caption</label>
            <textarea 
                name="caption" 
                id="caption"
                placeholder="Update your thoughts..."
                required
                maxlength="5000"
            >{{ post.caption }}</textarea>
            <span class="char-count">{{ post.caption|length }} / 5000</span>
        </div>
        
        <div class="form-group">
            <label for="category">Category (Optional)</label>
            <select name="category" id="category" class="select-input">
                <option value="">-- No Category --</option>
                {% for category in categories %}
                <option value="{{ category.id }}" {% if post.category.id == category.id %}selected{% endif %}>{{ category.icon }} {{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="image">Photo (Optional)</label>
            <div class="file-input-wrapper">
                <input 
                    type="file" 
                    name="image" 
                    id="image"
                    accept="image/*"
                >
                <label for="image" class="file-label">
                    <span class="file-icon">üì∑</span>
                    <span class="file-text">Choose a new image or drag & drop</span>
                </label>
                <div class="image-preview" id="imagePreview">
                    {% if post.image %}
                    <img src="{{ post.image.url }}" alt="Current image">
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="video">Video (Optional)</label>
            <div class="file-input-wrapper">
                <input 
                    type="file" 
                    name="video" 
                    id="video"
                    accept="video/*"
                >
                <label for="video" class="file-label">
                    <span class="file-icon">üé•</span>
                    <span class="file-text">Choose a new video or drag & drop</span>
                </label>
                <div class="video-preview" id="videoPreview">
                    {% if post.video %}
                    <video controls><source src="{{ post.video.url }}" type="video/mp4">Your browser does not support the video tag.</video>
                    {% endif %}
                </div>
            </div>
            <small class="form-hint">‚ö†Ô∏è Uploading a new photo or video will replace the existing media.</small>
        </div>
        
        <div class="form-actions">
            <a href="/" class="btn-cancel">Cancel</a>
            <button type="submit" class="btn-submit">üíæ Save Changes</button>
        </div>
    </form>
</div>

<script>
// Character counter
const textarea = document.getElementById('caption');
const charCount = document.querySelector('.char-count');
charCount.textContent = textarea.value.length + ' / 5000';
textarea.addEventListener('input', function() {
    charCount.textContent = this.value.length + ' / 5000';
});

// Image preview
const imageInput = document.getElementById('image');
const imagePreview = document.getElementById('imagePreview');
const imageFileText = document.querySelector('.file-input-wrapper:nth-of-type(1) .file-text');

imageInput.addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
        // Clear video input
        document.getElementById('video').value = '';
        document.getElementById('videoPreview').innerHTML = '';
        document.getElementById('videoPreview').style.display = 'none';
        
        const reader = new FileReader();
        reader.onload = function(e) {
            imagePreview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
            imagePreview.style.display = 'block';
            imageFileText.textContent = file.name;
        }
        reader.readAsDataURL(file);
    }
});

// Video preview
const videoInput = document.getElementById('video');
const videoPreview = document.getElementById('videoPreview');
const videoFileText = document.querySelector('.file-input-wrapper:nth-of-type(2) .file-text');

videoInput.addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
        // Clear image input
        document.getElementById('image').value = '';
        document.getElementById('imagePreview').innerHTML = '';
        document.getElementById('imagePreview').style.display = 'none';
        
        const reader = new FileReader();
        reader.onload = function(e) {
            videoPreview.innerHTML = `<video controls><source src="${e.target.result}" type="${file.type}">Your browser does not support the video tag.</video>`;
            videoPreview.style.display = 'block';
            videoFileText.textContent = file.name;
        }
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}
